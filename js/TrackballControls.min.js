THREE.TrackballControls=function(a,b){function u(a){c.enabled!==!1&&(window.removeEventListener("keydown",u),h=g,g===d.NONE&&(a.keyCode!==c.keys[d.ROTATE]||c.noRotate?a.keyCode!==c.keys[d.ZOOM]||c.noZoom?a.keyCode!==c.keys[d.PAN]||c.noPan||(g=d.PAN):g=d.ZOOM:g=d.ROTATE))}function v(){c.enabled!==!1&&(g=h,window.addEventListener("keydown",u,!1))}function w(a){c.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g===d.NONE&&(g=a.button),g!==d.ROTATE||c.noRotate?g!==d.ZOOM||c.noZoom?g!==d.PAN||c.noPan||(c.getMouseOnScreen(a.pageX,a.pageY,p),q.copy(p)):(c.getMouseOnScreen(a.pageX,a.pageY,l),m.copy(l)):(c.getMouseProjectionOnBall(a.pageX,a.pageY,j),k.copy(j)),document.addEventListener("mousemove",x,!1),document.addEventListener("mouseup",y,!1),c.dispatchEvent(s))}function x(a){c.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g!==d.ROTATE||c.noRotate?g!==d.ZOOM||c.noZoom?g!==d.PAN||c.noPan||c.getMouseOnScreen(a.pageX,a.pageY,q):c.getMouseOnScreen(a.pageX,a.pageY,m):c.getMouseProjectionOnBall(a.pageX,a.pageY,k))}function y(a){c.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),g=d.NONE,document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",y),c.dispatchEvent(t))}function z(a){if(c.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),l.y+=.01*b,c.dispatchEvent(s),c.dispatchEvent(t)}}function A(a){var b,e;if(c.enabled!==!1){switch(a.touches.length){case 1:g=d.TOUCH_ROTATE,k.copy(c.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,j));break;case 2:g=d.TOUCH_ZOOM,b=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY,o=n=Math.sqrt(b*b+e*e);break;case 3:g=d.TOUCH_PAN,q.copy(c.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,p));break;default:g=d.NONE}c.dispatchEvent(s)}}function B(a){var b,e;if(c.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:c.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,k);break;case 2:b=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY,o=Math.sqrt(b*b+e*e);break;case 3:c.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,q);break;default:g=d.NONE}}function C(a){if(c.enabled!==!1){switch(a.touches.length){case 1:j.copy(c.getMouseProjectionOnBall(a.touches[0].pageX,a.touches[0].pageY,k));break;case 2:n=o=0;break;case 3:p.copy(c.getMouseOnScreen(a.touches[0].pageX,a.touches[0].pageY,q))}g=d.NONE,c.dispatchEvent(t)}}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,c=this,d={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3,e=1e-6,f=new THREE.Vector3,g=d.NONE,h=d.NONE,i=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector2,m=new THREE.Vector2,n=0,o=0,p=new THREE.Vector2,q=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),r={type:"change"},s={type:"start"},t={type:"end"},this.handleResize=function(){var a,b;this.domElement===document?(this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight):(a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement,this.screen.left=a.left+window.pageXOffset-b.clientLeft,this.screen.top=a.top+window.pageYOffset-b.clientTop,this.screen.width=a.width,this.screen.height=a.height)},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)},this.getMouseOnScreen=function(a,b,d){return d.set((a-c.screen.left)/c.screen.width,(b-c.screen.top)/c.screen.height)},this.getMouseProjectionOnBall=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(d,e,f){b.set((d-.5*c.screen.width-c.screen.left)/(.5*c.screen.width),(.5*c.screen.height+c.screen.top-e)/(.5*c.screen.height),0);var g=b.length();return c.noRoll?b.z=g<Math.SQRT1_2?Math.sqrt(1-g*g):.5/g:g>1?b.normalize():b.z=Math.sqrt(1-g*g),i.copy(c.object.position).sub(c.target),f.copy(c.object.up).setLength(b.y),f.add(a.copy(c.object.up).cross(i).setLength(b.x)),f.add(i.setLength(b.z)),f}}(),this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var d=Math.acos(j.dot(k)/j.length()/k.length());d&&(a.crossVectors(j,k).normalize(),d*=c.rotateSpeed,b.setFromAxisAngle(a,-d),i.applyQuaternion(b),c.object.up.applyQuaternion(b),k.applyQuaternion(b),c.staticMoving?j.copy(k):(b.setFromAxisAngle(a,d*(c.dynamicDampingFactor-1)),j.applyQuaternion(b)))}}(),this.zoomCamera=function(){var a;g===d.TOUCH_ZOOM?(a=n/o,n=o,i.multiplyScalar(a)):(a=1+(m.y-l.y)*c.zoomSpeed,1!==a&&a>0&&(i.multiplyScalar(a),c.staticMoving?l.copy(m):l.y+=(m.y-l.y)*this.dynamicDampingFactor))},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,d=new THREE.Vector3;return function(){a.copy(q).sub(p),a.lengthSq()&&(a.multiplyScalar(i.length()*c.panSpeed),d.copy(i).cross(c.object.up).setLength(a.x),d.add(b.copy(c.object.up).setLength(a.y)),c.object.position.add(d),c.target.add(d),c.staticMoving?p.copy(q):p.add(a.subVectors(q,p).multiplyScalar(c.dynamicDampingFactor)))}}(),this.checkDistances=function(){c.noZoom&&c.noPan||(i.lengthSq()>c.maxDistance*c.maxDistance&&c.object.position.addVectors(c.target,i.setLength(c.maxDistance)),i.lengthSq()<c.minDistance*c.minDistance&&c.object.position.addVectors(c.target,i.setLength(c.minDistance)))},this.update=function(){i.subVectors(c.object.position,c.target),c.noRotate||c.rotateCamera(),c.noZoom||c.zoomCamera(),c.noPan||c.panCamera(),c.object.position.addVectors(c.target,i),c.checkDistances(),c.object.lookAt(c.target),f.distanceToSquared(c.object.position)>e&&(c.dispatchEvent(r),f.copy(c.object.position))},this.reset=function(){g=d.NONE,h=d.NONE,c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.up.copy(c.up0),i.subVectors(c.object.position,c.target),c.object.lookAt(c.target),c.dispatchEvent(r),f.copy(c.object.position)},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",w,!1),this.domElement.addEventListener("mousewheel",z,!1),this.domElement.addEventListener("DOMMouseScroll",z,!1),this.domElement.addEventListener("touchstart",A,!1),this.domElement.addEventListener("touchend",C,!1),this.domElement.addEventListener("touchmove",B,!1),window.addEventListener("keydown",u,!1),window.addEventListener("keyup",v,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);